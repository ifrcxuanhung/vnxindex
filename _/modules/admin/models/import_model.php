<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');
/* * *******************************************************************************************************************
 * Client  Name ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Project Name ：  cms v3.0
 * ---------------------------------------------------------------------------------------------------------------------
 * Program Name ：  import_model.php
 * ---------------------------------------------------------------------------------------------------------------------
 * Entry Server ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Called By    ：  System
 * ---------------------------------------------------------------------------------------------------------------------
 * Notice       ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Copyright    ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Comment      ：  model import
 * ---------------------------------------------------------------------------------------------------------------------
 * History      ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Version V001 ：  2012.09.12 (LongNguyen)        New Create
 * ******************************************************************************************************************* */

class Import_model extends CI_Model {

    var $table = 'vndb_files';

    function __construct() {
        parent::__construct();
    }

    /*     * ***********************************************************************************************************
     * Name         ： checkTable
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ：kiểm tra xem table có tồn tại chưa
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：  POST $nameTable
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ：bool true on table exist or false if table not exist
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function checkTable($nameTable) {
        if ($nameTable == '') {
            return FALSE;
        }
        $sql = "SHOW TABLES LIKE '{$nameTable}'";
        $query = $this->db->query($sql);
        if ($query->num_rows() == 0) {
            return FALSE;
        }
        return TRUE;
    }

    /*     * ***********************************************************************************************************
     * Name         ： getFields
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ：show all fields in table
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：  POST $Table
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ：array list field
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function getFields($table) {
        return $this->db->list_fields($table);
    }

    /*     * ***********************************************************************************************************
     * Name         ： insertData
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ： insert data
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：  $table (array) $data
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ： error if SQL error
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function insertData($table, $data) {
        $this->db->insert_batch($table, $data);
        return $this->db->_error_message();
    }

    /*     * ***********************************************************************************************************
     * Name         ： emptyTable
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ： truncate table
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：  $table
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ： bool
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function emptyTable($table) {
        return $this->db->truncate($table);
    }

    /*     * ***********************************************************************************************************
     * Name         ： getTotal
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ： get total rows in table
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：  $table
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ： int
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function getTotal($table) {
        return $this->db->count_all($table);
    }

    /*     * ***********************************************************************************************************
     * Name         ： listUploadFile
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ： get all rows in table idx_file if actve =9
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ： none
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ： array
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.09.12 (LongNguyen)
     * *************************************************************************************************************** */

    public function listUploadFile() {
        $query = $this->db->query("SELECT * FROM " . $this->table . " WHERE active=9");
        return $query->result_array();
    }

}
