<?php
require('_/modules/welcome/controllers/block.php');
/* * *******************************************************************************************************************
 * Client  Name ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Project Name ：  VNFDB
 * ---------------------------------------------------------------------------------------------------------------------
 * File Name    ：  page.php 
 * ---------------------------------------------------------------------------------------------------------------------
 * Entry Server ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Called By    ：  System
 * ---------------------------------------------------------------------------------------------------------------------
 * Notice       ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Copyright    ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Comment      ：
 * ---------------------------------------------------------------------------------------------------------------------
 * History      ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Version V001 ：  2013.07.8 (LongNguyen)        New Create 
 * ******************************************************************************************************************* */
class Page extends Welcome {

    protected $_lang;
        /*     * ***********************************************************************************************************
     * Name         ： __construct
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ：
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ：
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.08.14 (LongNguyen)  
     * *************************************************************************************************************** */
    function __construct() {
        parent::__construct();
        $this->load->model('article_model', 'marticle');
    }
    /*     * ***********************************************************************************************************
     * Name         ： index
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ：
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ：
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ：
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： New  2012.08.14 (LongNguyen)  
     * *************************************************************************************************************** */
    public function index() {
        $block = new Block;
        //$sql = "SELECT * FROM article LEFT JOIN article_description ON article.article_id = article_description.article_id WHERE category_id = '$code' AND lang_code = '$lang'";        
        $this->data->newsletter = $block->newsletter();
        $this->data->actualites = $block->actualites();
        //$this->data->product = $block->showProduct();
        $code = $this->uri->segment(3);
	
        /* change $code to $id */
		
		if($code == "glossary.html"){
			 $code = str_replace(".html", "", $code);
			 $this->data->data = $this->marticle->get_ifrc_article($code);
         
         
			$this->template->write_view('content', 'page/glossary', $this->data);
			$this->template->render();
			
		
		}
		else{
			if($code != "" && !is_numeric($code) && $code != "glossary.html") {
				$code = str_replace(".html", "", $code);
				$sql = "SELECT page.value
						FROM page
						WHERE page.code = '{$code}';";
				$ids = $this->db->query($sql)->result_array();
				$code = $ids[0]['value'];
				
					
			}
			else{
				exit('File Not Found');
			}
			
			  $this->data->data = $this->marticle->get_article_by_cate_id($code);
				$this->data->page = $this->marticle->get_page_by_cate_id($code);
				$this->template->write_view('content', 'page/list', $this->data);
				$this->template->render();
		}
        
    }


}

/* End of file welcome.php */
    /* Location: ./application/controllers/welcome.php */